<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <link rel="manifest" href="https://www.ardikars.com/manifest.json">
    <link rel="stylesheet" href="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Posts Tagged - ssh | Ardika Rommy Sanjaya &mdash; Software Engineer </title>
    <meta property="og:title" content="Posts Tagged - ssh | Ardika Rommy Sanjaya &mdash; Software Engineer " />
    <meta name="twitter:title" content="Posts Tagged - ssh | Ardika Rommy Sanjaya &mdash; Software Engineer " />

    <meta name="description" content="Catatan ngopek suka2.">
    <meta name="description" property="og:description" content="Catatan ngopek suka2." />
    <meta name="twitter:description" content="Catatan ngopek suka2." />

    <meta name="twitter:card" content="summary_large_image" />
    
    <meta property="og:url" content="https://www.ardikars.com/tag/ssh/" />

    <meta property="og:image" content="" />
    <meta name="twitter:image" content="" />

    <meta name="author" content="Ardika Rommy Sanjaya" />

    <meta name="copyright" content="Copyright by Ardika Rommy Sanjaya. All Rights Reserved." />

    <style>
        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 300;
            src: local('Roboto Light'), local('Roboto-Light'), url(https://fonts.gstatic.com/s/roboto/v15/Hgo13k-tfSpn0qi1SFdUfVtXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 400;
            src: local('Roboto'), local('Roboto-Regular'), url(https://fonts.gstatic.com/s/roboto/v15/CWB0XYA8bzo0kSThX0UTuA.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 700;
            src: local('Roboto Bold'), local('Roboto-Bold'), url(https://fonts.gstatic.com/s/roboto/v15/d-6IYplOFocCacKzxwXSOFtXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 900;
            src: local('Roboto Black'), local('Roboto-Black'), url(https://fonts.gstatic.com/s/roboto/v15/mnpfi9pxYH-Go5UiibESIltXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 300;
            src: local('Roboto Light Italic'), local('Roboto-LightItalic'), url(https://fonts.gstatic.com/s/roboto/v15/7m8l7TlFO-S3VkhHuR0at44P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 400;
            src: local('Roboto Italic'), local('Roboto-Italic'), url(https://fonts.gstatic.com/s/roboto/v15/vPcynSL0qHq_6dX7lKVByfesZW2xOQ-xsNqO47m55DA.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 700;
            src: local('Roboto Bold Italic'), local('Roboto-BoldItalic'), url(https://fonts.gstatic.com/s/roboto/v15/t6Nd4cfPRhZP44Q5QAjcC44P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 900;
            src: local('Roboto Black Italic'), local('Roboto-BlackItalic'), url(https://fonts.gstatic.com/s/roboto/v15/bmC0pGMXrhphrZJmniIZpY4P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }
    </style>
    
    <link href="/favicon.ico" rel="shortcut icon" type="image/x-icon" />
    
    <link rel="stylesheet" href="https://www.ardikars.com/assets/css/main.css">

    <link rel="canonical" href="https://www.ardikars.com/tag/ssh/">

    <link rel="alternate" type="application/rss+xml" title="Ardika Rommy Sanjaya" href="https://www.ardikars.com/feed.xml">
</head>


    <body>
        <div class="wrapper">
            <aside class="user-profile fixed" role="complementary">
    <div class="burger">
        <input class="trigger hidden" id="toggleBurger" type="checkbox" />
        <label for="toggleBurger">
            <span>Navigation</span>
        </label>
    </div>

    <div class="compact-header">
        <a class="avatar" href="https://www.ardikars.com"><img alt="Avatar" src="https://pbs.twimg.com/profile_images/1013821278862471168/GeIWLRAa_400x400.jpg" /></a>
        <div class="my-info">
            <strong class="my-name">Ardika Rommy Sanjaya</strong>
            <span class="my-job-title">Software Engineer</span>
        </div>
    </div>

    
        
        <div class="mainmenu">
            
            <a href="/" >Home</a>
            
            
                
            
                
            
                
            
                
                    <a href="https://www.ardikars.com/about/" >About</a>
                
            
                
                    <a href="https://www.ardikars.com/software/" >Software</a>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        </div>
        
    

    <p class="about-me">Catatan ngopek suka2.</p>

    <ul class="socials">
        <li><a href="https://twitter.com/ardikars"><svg title="twitter" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.ardikars.com/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li><li><a href="https://github.com/ardikars"><svg title="github" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.ardikars.com/assets/svg/social-icons.svg#github-icon"></use></svg></a></li>

        
            <li><a href="mailto:contact@ardikars"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.ardikars.com/assets/svg/social-icons.svg#email-icon"></use></svg></a></li>
        

        
    </ul>
</aside>


            <main class="the-content" role="main">
                <div class="search" role="search">
    <div>
        <div class="show-results-count">0 Results</div>
        <div class="search-holder">
            <input type="text" id="search-input" placeholder="search for..." />
        </div>
    </div>
    <ul id="results-container" class="results-container"></ul>
</div>


                <h1>Posts Tagged - ssh</h1>


    
        
    
        
    
        
    

    
        
    
        
    
        
    

    
        
    
        
        <article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
            <header class="post-header">
                <ul>
                    <li><time datetime="2020-07-25T21:12:00+00:00" itemprop="datePublished">25 Jul, 2020</time></li>
                    
                </ul>
                <h2 itemprop="name headline"><a href="https://www.ardikars.com/post/tunneling/ssh-tunneling-over-http-proxy.html">SSH tunneling over HTTP Proxy</a></h2>
            </header>

            <div class="post-content">
                <p><code class="highlighter-rouge">sudo apt update &amp;&amp; sudo apt install gcc</code></p>

<p><code class="highlighter-rouge">sudo vim http-injector-unix-client.c</code></p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
MIT License

Copyright (c) [2020] [Ardika Rommy Sanjaya]

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/</span>

<span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;arpa/inet.h&gt;
#include &lt;pthread.h&gt;
#include &lt;stddef.h&gt;
</span>
<span class="cp">#if (__STDC_VERSION__ &gt;= 199901L)
#include &lt;stdint.h&gt;
#endif
</span>
<span class="c1">// https://creativeandcritical.net/str-replace-c</span>
<span class="kt">char</span> <span class="o">*</span><span class="nf">repl_str</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">from</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">to</span><span class="p">)</span> <span class="p">{</span>

	<span class="cm">/* Adjust each of the below values to suit your needs. */</span>

	<span class="cm">/* Increment positions cache size initially by this number. */</span>
	<span class="kt">size_t</span> <span class="n">cache_sz_inc</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
	<span class="cm">/* Thereafter, each time capacity needs to be increased,
	 * multiply the increment by this factor. */</span>
	<span class="k">const</span> <span class="kt">size_t</span> <span class="n">cache_sz_inc_factor</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
	<span class="cm">/* But never increment capacity by more than this number. */</span>
	<span class="k">const</span> <span class="kt">size_t</span> <span class="n">cache_sz_inc_max</span> <span class="o">=</span> <span class="mi">1048576</span><span class="p">;</span>

	<span class="kt">char</span> <span class="o">*</span><span class="n">pret</span><span class="p">,</span> <span class="o">*</span><span class="n">ret</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pstr2</span><span class="p">,</span> <span class="o">*</span><span class="n">pstr</span> <span class="o">=</span> <span class="n">str</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">i</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="cp">#if (__STDC_VERSION__ &gt;= 199901L)
</span>	<span class="kt">uintptr_t</span> <span class="o">*</span><span class="n">pos_cache_tmp</span><span class="p">,</span> <span class="o">*</span><span class="n">pos_cache</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="cp">#else
</span>	<span class="kt">ptrdiff_t</span> <span class="o">*</span><span class="n">pos_cache_tmp</span><span class="p">,</span> <span class="o">*</span><span class="n">pos_cache</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="cp">#endif
</span>	<span class="kt">size_t</span> <span class="n">cache_sz</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">cpylen</span><span class="p">,</span> <span class="n">orglen</span><span class="p">,</span> <span class="n">retlen</span><span class="p">,</span> <span class="n">tolen</span><span class="p">,</span> <span class="n">fromlen</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">from</span><span class="p">);</span>

	<span class="cm">/* Find all matches and cache their positions. */</span>
	<span class="k">while</span> <span class="p">((</span><span class="n">pstr2</span> <span class="o">=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">pstr</span><span class="p">,</span> <span class="n">from</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">count</span><span class="o">++</span><span class="p">;</span>

		<span class="cm">/* Increase the cache size when necessary. */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cache_sz</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">cache_sz</span> <span class="o">+=</span> <span class="n">cache_sz_inc</span><span class="p">;</span>
			<span class="n">pos_cache_tmp</span> <span class="o">=</span> <span class="n">realloc</span><span class="p">(</span><span class="n">pos_cache</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">pos_cache</span><span class="p">)</span> <span class="o">*</span> <span class="n">cache_sz</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">pos_cache_tmp</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">goto</span> <span class="n">end_repl_str</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="n">pos_cache</span> <span class="o">=</span> <span class="n">pos_cache_tmp</span><span class="p">;</span>
			<span class="n">cache_sz_inc</span> <span class="o">*=</span> <span class="n">cache_sz_inc_factor</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">cache_sz_inc</span> <span class="o">&gt;</span> <span class="n">cache_sz_inc_max</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">cache_sz_inc</span> <span class="o">=</span> <span class="n">cache_sz_inc_max</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="n">pos_cache</span><span class="p">[</span><span class="n">count</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pstr2</span> <span class="o">-</span> <span class="n">str</span><span class="p">;</span>
		<span class="n">pstr</span> <span class="o">=</span> <span class="n">pstr2</span> <span class="o">+</span> <span class="n">fromlen</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">orglen</span> <span class="o">=</span> <span class="n">pstr</span> <span class="o">-</span> <span class="n">str</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">pstr</span><span class="p">);</span>

	<span class="cm">/* Allocate memory for the post-replacement string. */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tolen</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">to</span><span class="p">);</span>
		<span class="n">retlen</span> <span class="o">=</span> <span class="n">orglen</span> <span class="o">+</span> <span class="p">(</span><span class="n">tolen</span> <span class="o">-</span> <span class="n">fromlen</span><span class="p">)</span> <span class="o">*</span> <span class="n">count</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span>	<span class="n">retlen</span> <span class="o">=</span> <span class="n">orglen</span><span class="p">;</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">retlen</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">goto</span> <span class="n">end_repl_str</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* If no matches, then just duplicate the string. */</span>
		<span class="n">strcpy</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* Otherwise, duplicate the string whilst performing
		 * the replacements using the position cache. */</span>
		<span class="n">pret</span> <span class="o">=</span> <span class="n">ret</span><span class="p">;</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">pret</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">pos_cache</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="n">pret</span> <span class="o">+=</span> <span class="n">pos_cache</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">memcpy</span><span class="p">(</span><span class="n">pret</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">tolen</span><span class="p">);</span>
			<span class="n">pret</span> <span class="o">+=</span> <span class="n">tolen</span><span class="p">;</span>
			<span class="n">pstr</span> <span class="o">=</span> <span class="n">str</span> <span class="o">+</span> <span class="n">pos_cache</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">fromlen</span><span class="p">;</span>
			<span class="n">cpylen</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">count</span><span class="o">-</span><span class="mi">1</span> <span class="o">?</span> <span class="n">orglen</span> <span class="o">:</span> <span class="n">pos_cache</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">pos_cache</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">fromlen</span><span class="p">;</span>
			<span class="n">memcpy</span><span class="p">(</span><span class="n">pret</span><span class="p">,</span> <span class="n">pstr</span><span class="p">,</span> <span class="n">cpylen</span><span class="p">);</span>
			<span class="n">pret</span> <span class="o">+=</span> <span class="n">cpylen</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">ret</span><span class="p">[</span><span class="n">retlen</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
	<span class="p">}</span>

<span class="nl">end_repl_str:</span>
	<span class="cm">/* Free the cache and return the post-replacement string,
	 * which will be NULL in the event of an error. */</span>
	<span class="n">free</span><span class="p">(</span><span class="n">pos_cache</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* connecting to http proxy */</span>

<span class="kt">void</span> <span class="nf">printHelp</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"ssh ardikars@103.129.220.168 -o ProxyCommand=</span><span class="se">\"</span><span class="s">./http-injector-client -x 192.168.43.172:44533 -P </span><span class="se">\'</span><span class="s">CONNECT 103.129.220.168:22 HTTP/1.1[crlf*2]</span><span class="se">\'\"\n\n</span><span class="s">"</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"-x: HTTP Proxy.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"-P: HTTP Payload.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"-s: Buffer size (Optional, default: 1023).</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="o">*</span><span class="nf">reader</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span> <span class="n">args</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    		<span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ch</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stdin</span><span class="p">);</span>
		<span class="n">send</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">ch</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="o">*</span><span class="nf">writer</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span> <span class="n">args</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">recv</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">ch</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ch</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stdout</span><span class="p">);</span>
		<span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>

	<span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">remote</span><span class="p">;</span> 

	<span class="kt">char</span> <span class="o">*</span><span class="n">proxy_host</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">proxy_port</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="kt">char</span> <span class="o">*</span><span class="n">payload</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">buf_size</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">opt</span><span class="p">;</span>
  	<span class="k">while</span> <span class="p">((</span><span class="n">opt</span> <span class="o">=</span> <span class="n">getopt</span> <span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="s">"x:h:s:P:"</span><span class="p">))</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">opt</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">case</span> <span class="sc">'x'</span><span class="p">:</span>
				<span class="n">proxy_host</span> <span class="o">=</span> <span class="n">strtok</span><span class="p">(</span><span class="n">optarg</span><span class="p">,</span> <span class="s">":"</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">proxy_host</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">proxy_port</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">strtok</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="s">":"</span><span class="p">));</span>
				<span class="p">}</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="sc">'h'</span><span class="p">:</span>
				<span class="n">printHelp</span><span class="p">();</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="sc">'s'</span><span class="p">:</span>
				<span class="n">buf_size</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">optarg</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="sc">'P'</span><span class="p">:</span>
				<span class="n">payload</span> <span class="o">=</span> <span class="n">optarg</span><span class="p">;</span>
				<span class="n">payload</span> <span class="o">=</span> <span class="n">repl_str</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="s">"[cr]"</span><span class="p">,</span> <span class="s">"</span><span class="se">\r</span><span class="s">"</span><span class="p">);</span>
				<span class="n">payload</span> <span class="o">=</span> <span class="n">repl_str</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="s">"[lf]"</span><span class="p">,</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
				<span class="n">payload</span> <span class="o">=</span> <span class="n">repl_str</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="s">"[crlf]"</span><span class="p">,</span> <span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="p">);</span>
				<span class="n">payload</span> <span class="o">=</span> <span class="n">repl_str</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="s">"[crlf*2]"</span><span class="p">,</span> <span class="s">"</span><span class="se">\r\n\r\n</span><span class="s">"</span><span class="p">);</span>
				<span class="n">payload</span> <span class="o">=</span> <span class="n">repl_str</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="s">"[lfcr]"</span><span class="p">,</span> <span class="s">"</span><span class="se">\n\r</span><span class="s">"</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	
	<span class="k">if</span> <span class="p">(</span><span class="n">proxy_host</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">proxy_port</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">payload</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printHelp</span><span class="p">();</span>
		<span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="n">buf_size</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">sent</span><span class="p">,</span> <span class="n">read</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pthread_t</span> <span class="n">worker</span><span class="p">;</span>


	<span class="k">if</span> <span class="p">((</span><span class="n">fd</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Failed to open socket file descriptor.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">remote</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
	<span class="n">remote</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">proxy_port</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">inet_pton</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">proxy_host</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">remote</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        	<span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Invalid address/Address not supported.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
		<span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
        	<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">connect</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">remote</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">remote</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        	<span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Connection Failed.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
		<span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
        	<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">sent</span> <span class="o">=</span> <span class="n">send</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">payload</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Failed to send HTTP payload.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
		<span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="sc">'\0'</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">read</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">read</span> <span class="o">=</span> <span class="n">recv</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">read</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="n">read</span> <span class="o">-</span> <span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\r'</span> <span class="o">&amp;&amp;</span> <span class="n">buffer</span><span class="p">[</span><span class="n">read</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\n'</span> <span class="o">&amp;&amp;</span> <span class="n">buffer</span><span class="p">[</span><span class="n">read</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\r'</span> <span class="o">&amp;&amp;</span> <span class="n">buffer</span><span class="p">[</span><span class="n">read</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">read</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">worker</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">fd</span><span class="p">);</span> 
	<span class="n">writer</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">fd</span><span class="p">);</span>

	<span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">gcc http-injector-unix-client.c -o http-injector-client -lpthread</code></p>

<p><code class="highlighter-rouge">ssh marshall-vpnjantit.com@103.129.220.168 -o "ProxyCommand=./http-injector-client -x 192.168.43.173:44355 -P 'CONNECT 103.129.220.168:22 HTTP/1.1[crlf*2]'"</code></p>

<p>*) Parameters</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">-x</code>: HTTP Proxy</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">-P</code>: HTTP request payload (Request connection to ssh server)</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">-s</code>: Buffer size (Optional), default value is 1024.</p>
  </li>
</ul>


                
                    <p><a href="/post/tunneling/ssh-tunneling-over-http-proxy.html" role="button">Read More</a></p>
                
            </div>

            <footer class="post-footer">
                <div class="share">Share
                    <ul class="social-networks">
                        <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=SSH tunneling over HTTP Proxy&p[summary]=sudo apt update &amp;&amp; sudo apt install gcc

sudo vim http-injector-unix-client.c

/*
MIT License

Copyright (c) [2020] [Ardika Rommy...&p[url]=https://www.ardikars.com/post/tunneling/ssh-tunneling-over-http-proxy.html" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.ardikars.com/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                        <li class="share-twitter"><a href="http://twitter.com/share?url=https://www.ardikars.com/post/tunneling/ssh-tunneling-over-http-proxy.html&text=sudo apt update &amp;&amp; sudo apt install gcc

sudo vim http-injector-unix-client.c

/*
MIT License

Copyright (c) [2020] [Ardika Rommy...&hashtags=http,ssh,injector," rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.ardikars.com/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
                    </ul>
                </div>
                
                <div class="tags">
                    <ul>
                        
                        <li><a href="https://www.ardikars.com/tag/http">http</a></li>
                        
                        <li><a href="https://www.ardikars.com/tag/ssh">ssh</a></li>
                        
                        <li><a href="https://www.ardikars.com/tag/injector">injector</a></li>
                        
                    </ul>
                </div>
                
            </footer>
        </article>
        
    
        
    

    
        
        <article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
            <header class="post-header">
                <ul>
                    <li><time datetime="2020-07-23T12:41:00+00:00" itemprop="datePublished">23 Jul, 2020</time></li>
                    
                </ul>
                <h2 itemprop="name headline"><a href="https://www.ardikars.com/post/tunnelling/ssh-tunnel-without-command-execution.html">SSH tunneling without opening shell</a></h2>
            </header>

            <div class="post-content">
                <p><code class="highlighter-rouge">ssh -D 8123 -fN root@ardikars.com</code></p>

<ul>
  <li>
    <p><code class="highlighter-rouge">-D</code>: Create socks proxy, listening on port 8123</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">-f</code>: Requests ssh to go to background just before command execution.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">-N</code>: Do not execute a remote command.</p>
  </li>
</ul>


                
                    <p><a href="/post/tunnelling/ssh-tunnel-without-command-execution.html" role="button">Read More</a></p>
                
            </div>

            <footer class="post-footer">
                <div class="share">Share
                    <ul class="social-networks">
                        <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=SSH tunneling without opening shell&p[summary]=ssh -D 8123 -fN root@ardikars.com


  
    -D: Create socks proxy, listening on port 8123
  
  
    -f: Requests ssh to go to background ...&p[url]=https://www.ardikars.com/post/tunnelling/ssh-tunnel-without-command-execution.html" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.ardikars.com/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                        <li class="share-twitter"><a href="http://twitter.com/share?url=https://www.ardikars.com/post/tunnelling/ssh-tunnel-without-command-execution.html&text=ssh -D 8123 -fN root@ardikars.com


  
    -D: Create socks proxy, listening on port 8123
  
  
    -f: Requests ssh to go to background ...&hashtags=ssh,proxy,http," rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.ardikars.com/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
                    </ul>
                </div>
                
                <div class="tags">
                    <ul>
                        
                        <li><a href="https://www.ardikars.com/tag/ssh">ssh</a></li>
                        
                        <li><a href="https://www.ardikars.com/tag/proxy">proxy</a></li>
                        
                        <li><a href="https://www.ardikars.com/tag/http">http</a></li>
                        
                    </ul>
                </div>
                
            </footer>
        </article>
        
    
        
    
        
    

    
        
    
        
    
        
    

    
        
    
        
    
        
    

    
        
    
        
    
        
    

    
        
    
        
    
        
    

    
        
    
        
    

    
        
    
        
    
        
    

    
        
    
        
    
        
    

    
        
    
        
    
        
    

    
        
    
        
    
        
    

    
        
    
        
    
        
    

    
        
    
        
    
        
    

    
        
    
        
    

    
        
    
        
    
        
    

    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    

            </main>
        </div>

        <script src="https://www.ardikars.com/assets/js/jquery-1.12.2.min.js"></script>
<script src="https://www.ardikars.com/assets/js/backtotop.js"></script>
<script src="https://www.ardikars.com/assets/js/lunr.min.js"></script>
<script src="https://www.ardikars.com/assets/js/lunr-feed.js"></script>
<script src="https://www.ardikars.com/assets/js/jquery.fitvids.js"></script>
<script src="https://www.ardikars.com/assets/js/svg4everybody.min.js"></script>
<script src="https://www.ardikars.com/assets/js/scripts.js"></script>
<script>
    if('serviceWorker' in navigator){
        navigator.serviceWorker.register("https://www.ardikars.com/sw.js")
            .then(reg => console.log('service worker registered'))
            .catch(err => console.log('service worker not registered', err));
    }
</script>



    </body>
</html>